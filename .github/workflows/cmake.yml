name: CMake GH Actions

on: push

jobs:
  build-linux:
    runs-on: ubuntu-22.04

    steps:
      - name: Clone Repository
        run: git clone --recursive https://github.com/hyrise-mp-22-23/hyrise.git hyrise && cd hyrise

      - name: Install Dependencies
        run: sudo apt-get install --no-install-recommends -y autoconf bash-completion bc clang-11 clang-14 clang-format-14 clang-tidy-14 cmake curl dos2unix g++-9 gcc-9 g++-11 gcc-11 gcovr git graphviz libboost-all-dev libhwloc-dev libncurses5-dev libnuma-dev libnuma1 libpq-dev libreadline-dev libsqlite3-dev libtbb-dev lld man ninja-build parallel python3 python3-pip valgrind

      - name: Install umap
        run: |
            git clone https://github.com/LLNL/umap.git umap
            mkdir umap/build && cd umap/build
            cmake -DCMAKE_INSTALL_PREFIX=./umap ..
            make
            make install
            sudo cp -r umap/include/umap /usr/include/
            sudo cp umap/include/umap/umap.h /usr/include/ 

      - name: Run CMake
        run: |
            cd ${{github.workspace}}/hyrise/
            mkdir cmake-build-debug && cd cmake-build-debug
            cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ ..
      
      - name: Run Make
        run: |
            cd ${{github.workspace}}/hyrise/cmake-build-debug
            make hyriseConsole -j4
            echo "Build Finished Successfully"


